version: "3.7"
services:
  clickhouse-server:
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse-server
    volumes:
     - ../clickhouse-server/datas:/var/lib/clickhouse
     - ../clickhouse-server/log:/var/log/clickhouse-server
    ports:
      - "18123:8123" #  HTTP
      - "19000:9000" # TCP
      - "19009:9009" # Postgres
    deploy:
      replicas: 1
      #restart_policy:
      #  condition: on-failure
    # `proton` depends on STREAM_STORAGE_BROKERS env variable
    # to discover stream store
    command: >
      /bin/bash -c "echo sleeping; sleep 2; /entrypoint.sh"

networks:
  default:
    driver: bridge
    ipam:
      driver: default
      config:
        - subnet: "192.168.12.0/24"