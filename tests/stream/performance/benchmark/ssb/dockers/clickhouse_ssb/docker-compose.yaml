version: "3.7"
services:
  clickhouse-server:
    image: clickhouse/clickhouse-server:latest
    container_name: clickhouse-server
    volumes:
     - ../clickhouse-server/datas:/var/lib/clickhouse
     - ../clickhouse-server/log:/var/log/clickhouse-server
    ports:
      - "18123:18123" #  HTTP
      - "9000:9000" # TCP
      - "9009:9009" # Postgres
    deploy:
      replicas: 1
      #restart_policy:
      #  condition: on-failure
    # `proton` depends on STREAM_STORAGE_BROKERS env variable
    # to discover stream store
    command: >
      /bin/bash -c "echo sleeping; sleep 2; /entrypoint.sh"
