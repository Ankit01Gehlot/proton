{
    "test_suite_name": "rest",
    "test_suite_config": {
        "tests_2_run": {
            "ids_2_run": [
                "all"
            ],
            "tags_2_run": [],
            "tags_2_skip": [
                "todo",
                "to_support",
                "change",
                "bug",
                "sample"
            ]
        }
    },
    "commments": "Tests covering the steam query smoke cases.",
    "tests": [
        {
            "id": 0,
            "tags": [
                "sqlformat"
            ],
            "name": "sqlformat",
            "description": "send a sqlformat request",
            "steps": [
                {
                    "statements": [
                        {
                            "client": "rest",
                            "rest_type": "raw",
                            "query_type": "table",
                            "query_id": "101",
                            "query_url": "/proton/v1/sqlformat",
                            "http_method": "POST",
                            "data": {
                                "query": "select a.id, b.type, max(a.value), window_start as joined_w_start, window_end as joined_w_end from hop( test, timestamp, interval 3 second, interval 5 second ) as a join table(test_d) as b on a.id = b.id where b.type = 'roof' or b.type = 'field' or b.type = 'wall' group by a.id, b.type, window_start, window_end"
                            }
                        }
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id": "101",
                    "expected_results": {
                        "query": "SELECT\n    a.id,\n    b.type,\n    max(a.value),\n    window_start AS joined_w_start,\n    window_end AS joined_w_end\nFROM hop(test, timestamp, INTERVAL 3 SECOND, INTERVAL 5 SECOND) AS a\nINNER JOIN table(test_d) AS b ON a.id = b.id\nWHERE (b.type = 'roof') OR (b.type = 'field') OR (b.type = 'wall')\nGROUP BY\n    a.id,\n    b.type,\n    window_start,\n    window_end",
                        "request_id": "any_value"
                    }
                }
            ]
        },
        {
            "id": 1,
            "tags": [
                "http_snap_shot"
            ],
            "name": "http_snap_shot",
            "description": "http_snap_shot insert, select",
            "steps": [
                {
                    "statements": [
                        {
                            "client": "python",
                            "query_type": "table",
                            "query": "drop stream if exists test"
                        },
                        {
                            "client": "python",
                            "query_type": "table",
                            "query": "create stream test (id string, location string, value float, timestamp datetime64(3) default now64(3))"
                        },
                        {
                            "client": "python",
                            "query_type": "table",
                            "wait": 1,
                            "query": "insert into test (id, location, value, timestamp) values ('dev1', 'ca', 100, '2020-01-01 11:11:11')"
                        },
                        {
                            "client": "python",
                            "query_type": "table",
                            "query": "insert into test (id, value, location, timestamp) values ('dev2', 100, 'ca', '2020-01-01 11:11:11')"
                        },
                        {
                            "client": "python",
                            "query_type": "table",
                            "query": "insert into test (id, value, timestamp) values ('dev3', 100, '2020-01-01 11:11:11')"
                        },
                        {
                            "client": "rest",
                            "rest_type": "http_snapshot",
                            "query_type": "table",
                            "query_id": "101",
                            "query_url": "/?query=show streams where name = 'test'",
                            "http_method": "GET"
                        }
                    ]
                },
                {
                    "statements": [
                        {
                            "client": "rest",
                            "rest_type": "http_snapshot",
                            "query_type": "table",
                            "wait": 1,
                            "query_url": "/",
                            "http_method": "POST",
                            "data": "insert into test (id, value, timestamp) values ('dev777', 100, '2020-01-01 11:11:11')"
                        }
                    ]
                },
                {
                    "statements": [
                        {
                            "client": "rest",
                            "rest_type": "http_snapshot",
                            "query_type": "table",
                            "wait": 2,
                            "query_id": "102",
                            "query_url": "/",
                            "http_method": "POST",
                            "data": "select id, location, value, timestamp from test order by id format JSON"
                        }
                    ]
                },
                {
                    "statements": [
                        {
                            "client": "rest",
                            "rest_type": "http_snapshot",
                            "query_type": "table",
                            "query_id": "103",
                            "query_url": "/",
                            "http_method": "POST",
                            "data": "select id, location, value, value, timestamp from test order by id"
                        }
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id": "101",
                    "expected_results": "test\n"
                },
                {
                    "query_id": "102",
                    "expected_results": {
                        "meta": [
                            {
                                "name": "id",
                                "type": "string"
                            },
                            {
                                "name": "location",
                                "type": "string"
                            },
                            {
                                "name": "value",
                                "type": "float32"
                            },
                            {
                                "name": "timestamp",
                                "type": "datetime64(3)"
                            }
                        ],
                        "data": [
                            {
                                "id": "dev1",
                                "location": "ca",
                                "value": 100,
                                "timestamp": "2020-01-01 11:11:11.000"
                            },
                            {
                                "id": "dev2",
                                "location": "ca",
                                "value": 100,
                                "timestamp": "2020-01-01 11:11:11.000"
                            },
                            {
                                "id": "dev3",
                                "location": "",
                                "value": 100,
                                "timestamp": "2020-01-01 11:11:11.000"
                            },
                            {
                                "id": "dev777",
                                "location": "",
                                "value": 100,
                                "timestamp": "2020-01-01 11:11:11.000"
                            }
                        ],
                        "rows": 4,
                        "statistics": "any_value"
                    }
                },
                {
                    "query_id": "103",
                    "expected_results": "dev1\tca\t100\t100\t2020-01-01 11:11:11.000\ndev2\tca\t100\t100\t2020-01-01 11:11:11.000\ndev3\t\t100\t100\t2020-01-01 11:11:11.000\ndev777\t\t100\t100\t2020-01-01 11:11:11.000\n"
                }
            ]
        }
    ]
}
