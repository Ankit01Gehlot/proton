{
    "test_suite_name": "query_state4_source",
    "tag": "smoke",
    "test_suite_config":{
        "setup": {
            "statements": [
                {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view"},
                {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                {"client":"python", "query_type": "table", "query":"drop stream if exists view_join"},
                {"client":"python", "query_type": "table", "wait":1, "query":"create stream view_join (id string, type string)"},
                {"client":"python", "query_type": "table", "depends_on_stream":"view_join", "wait":1, "query": "insert into view_join(id, type) values ('dev1', 'roof'), ('dev2', 'field'), ('dev3', 'window'), ('dev4', 'wall') ('dev5', 'roof'), ('dev6', 'window'), ('dev7', 'wall'), ('dev8', 'floor')"}
            ]
        },
        "tests_2_run": {"ids_2_run": ["all"], "tags_2_run":[], "tags_2_skip":{"default":["todo", "to_support", "change", "bug", "sample", "native_not_support"],"cluster": ["view", "cluster_table_bug"]}}
    }, 
    "comments": "Tests covering query state checkpointing smoke test cases",
    "tests": [
        {
            "id": 150,
            "tags": ["query_state", "tail"],
            "name": "tail_query_view",
            "description": "tail query from view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value from state_view_stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19150",  "wait":1, "terminate":"manuel", "query":"subscribe to select id, value from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19150", "kill":"19150", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19150'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19150",
                    "expected_results":[
                        ["dev1", "57.3"]
                    ]
                }
            ]
        },
        {
            "id": 151,
            "tags": ["query_state", "tail"],
            "name": "recover_tail_query_view",
            "description": "recover tail query from view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value from state_view_stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19151", "wait":1, "terminate":"manuel", "query":"subscribe to select id, value from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19151", "kill":"19151", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:01')"},
                        {"client":"python", "query_type": "stream", "query_id":"19151-1", "terminate": "manual", "wait":2, "query":"recover from '19151'"},
                        {"client":"python", "query_type": "table", "depends_on":"19151", "wait":1, "query": "kill query where query_id='19151' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19151'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19151",
                    "expected_results":[
                        ["dev1", "57.3"]
                    ]
                },
                {
                    "query_id":"19151-1",
                    "expected_results":[
                        ["dev2", "58.3"]
                    ]
                }
            ]
        },
        {
            "id": 152,
            "tags": ["query_state", "aggr"],
            "name": "global_aggr_query_view_without_group_by",
            "description": "global aggregation query from view without group by state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select count(), sum(value), avg(value), min(value), max(value) from state_view_stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19152",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19152", "kill":"19152", "kill_wait":3, "wait":1, "query": "insert into state_view_stream (id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00'), ('dev1', 'ca', 66, '2020-02-02 20:00:01'), ('dev2', 'ca', 58.3, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19152'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19152",
                    "expected_results":[
                        ["3", "181.6", "60.5", "57.3", "66"]
                    ]
                }
            ]
        },
        {
            "id": 153,
            "tags": ["query_state", "aggr"],
            "name": "global_aggr_query_view_without_group_by",
            "description": "global aggregation query from view without group by state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select count(), sum(value), avg(value), min(value), max(value) from state_view_stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19153",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19153", "kill":"19153", "kill_wait":3, "wait":1, "query": "insert into state_view_stream (id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00'), ('dev1', 'ca', 66, '2020-02-02 20:00:01'), ('dev2', 'ca', 58.3, '2020-02-02 20:00:02')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 80, '2020-02-02 20:00:02'), ('dev8', 'ca', 67, '2020-02-02 20:00:02'), ('dev8', 'ca', 77, '2020-02-02 20:00:08')"},
                        {"client":"python", "query_type": "stream", "query_id":"19153-1", "terminate": "manual", "wait":2, "query":"recover from '19153'"},
                        {"client":"python", "query_type": "table", "depends_on":"19153", "wait":1, "query": "kill query where query_id='19153' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19153'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19153",
                    "expected_results":[
                        ["3", "181.6", "60.5", "57.3", "66"]
                    ]
                },
                {
                    "query_id":"19153-1",
                    "expected_results":[
                        ["6", "405.6", "67.5", "57.3", "80"]
                    ]
                }
            ]
        },
        {
            "id": 154,
            "tags": ["query_state", "aggr"],
            "name": "global_aggr_query_view_with_group_by",
            "description": "global aggregation query from view withgroup by state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, count(), sum(value), avg(value), min(value), max(value) from state_view_stream group by id"},
                        {"client":"python", "query_type": "stream", "query_id":"19154",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19154", "kill":"19154", "kill_wait":3, "wait":1, "query": "insert into state_view_stream (id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00'), ('dev1', 'ca', 66, '2020-02-02 20:00:01'), ('dev2', 'ca', 58.3, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19154'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19154",
                    "expected_results":[
                        ["dev1", "2", "123.3", "61.7", "57.3", "66"],
                        ["dev2", "1", "58.3", "58.3", "58.3", "58.3"]
                    ]
                }
            ]
        },
        {
            "id": 155,
            "tags": ["query_state", "aggr"],
            "name": "recover_global_aggr_query_view_with_group_by",
            "description": "recover global aggregation query from view with group by from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, count(), sum(value), avg(value), min(value), max(value) from state_view_stream group by id"},
                        {"client":"python", "query_type": "stream", "query_id":"19155",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on": "19155", "kill":"19155", "kill_wait":3, "wait":1, "query": "insert into state_view_stream (id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00'), ('dev1', 'ca', 66, '2020-02-02 20:00:01'), ('dev2', 'ca', 58.3, '2020-02-02 20:00:02')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 80, '2020-02-02 20:00:02'), ('dev8', 'ca', 67, '2020-02-02 20:00:02'), ('dev8', 'ca', 77, '2020-02-02 20:00:08')"},
                        {"client":"python", "query_type": "stream", "query_id":"19155-1", "terminate": "manual", "wait":2, "query":"recover from '19155'"},
                        {"client":"python", "query_type": "table", "depends_on":"19155", "wait":1, "query": "kill query where query_id='19155' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19155'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19155",
                    "expected_results":[
                        ["dev1", "2", "123.3", "61.7", "57.3", "66"],
                        ["dev2", "1", "58.3", "58.3", "58.3", "58.3"]
                    ]
                },
                {
                    "query_id":"19155-1",
                    "expected_results":[
                        ["dev1", "2", "123.3", "61.7", "57.3", "66"],
                        ["dev2", "2", "138.3", "69.1", "58.3", "80"],
                        ["dev8", "2", "144", "72", "67", "77"]
                    ]
                }
            ]
        },
        {
            "id": 156,
            "tags": ["query_state", "aggr"],
            "name": "tumble_window_query_view",
            "description": "tumble window query from view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, sum(value), window_start, window_end from tumble(state_view_stream, timestamp, 5s) group by id, window_start, window_end emit stream "},
                        {"client":"python", "query_type": "stream", "query_id":"19156",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19156", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 66, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:04')"},  
                        {"client":"python", "query_type": "table", "kill":"19156", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 80, '2020-02-02 20:00:08')"},                      
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19156'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19156",
                    "expected_results":[
                        ["dev1", "123.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                }
            ]
        },
        {
            "id": 157,
            "tags": ["query_state", "aggr"],
            "name": "recover_tumble_window_query_view",
            "description": "recover tumble window query from view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, sum(value), window_start, window_end from tumble(state_view_stream, timestamp, 5s) group by id, window_start, window_end emit stream "},
                        {"client":"python", "query_type": "stream", "query_id":"19157",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19157", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 66, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:04')"},  
                        {"client":"python", "query_type": "table", "kill":"19157", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 80, '2020-02-02 20:00:08')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 67, '2020-02-02 20:00:06')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 77, '2020-02-02 20:00:07')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:11')"},                      
                        {"client":"python", "query_type": "stream","query_id":"19157-1", "terminate": "manual","wait":3, "query":"recover from '19157'"},
                        {"client":"python", "query_type": "table", "depends_on":"19157", "wait":1, "query": "kill query where query_id='19157' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19157'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19157",
                    "expected_results":[
                        ["dev1", "123.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                },
                {
                    "query_id":"19157-1",
                    "expected_results":[
                        ["dev2", "80", "2020-02-02 20:00:05", "2020-02-02 20:00:10"],
                        ["dev8", "144", "2020-02-02 20:00:05", "2020-02-02 20:00:10"]
                    ]
                }
            ]
        },
        {
            "id": 158,
            "tags": ["query_state", "window"],
            "name": "hop_window_query_view_with_group_by",
            "description": "hop window query from view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, max(value), window_start, window_end from hop(state_view_stream, timestamp, 3s, 5s) group by id, window_start, window_end emit stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19158",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19158", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:04')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 69, '2020-02-02 20:00:06')"},                      
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 68, '2020-02-02 20:00:07')"},  
                        {"client":"python", "query_type": "table", "kill":"19158", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19158'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19158",
                    "expected_results":[
                        ["dev1", "57.3", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                        ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev6", "66", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "58.3", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev6", "69", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev8", "68", "2020-02-02 20:00:03", "2020-02-02 20:00:08"]
                    ]
                }
            ]
        },
        {
            "id": 159,
            "tags": ["query_state", "window"],
            "name": "recover_hop_window_query_view",
            "description": "recover hop window query from view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, max(value), window_start, window_end from hop(state_view_stream, timestamp, 3s, 5s) group by id, window_start, window_end emit stream"},
                        {"client":"python", "query_type": "stream", "query_id":"19159",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19159", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:04')"},  
                        {"client":"python", "query_type": "table", "kill":"19159", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 69, '2020-02-02 20:00:06')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 68, '2020-02-02 20:00:07')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "stream","query_id":"19159-1", "terminate": "manual","wait":2, "query":"recover from '19159'"},
                        {"client":"python", "query_type": "table", "depends_on":"19159", "wait":1, "query": "kill query where query_id='19159' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19159'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19159",
                    "expected_results":[
                        ["dev1", "57.3", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                        ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev6", "66", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                },
                {
                    "query_id":"19159-1",
                    "expected_results":[
                        ["dev2", "58.3", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev6", "69", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev8", "68", "2020-02-02 20:00:03", "2020-02-02 20:00:08"]
                    ]
                }
            ]
        },
        {
            "id": 160,
            "tags": ["query_state", "window"],
            "name": "session_window_query_view_with_group_by",
            "description": "session window query from view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, max(value), window_start, window_end from session(state_view_stream, timestamp, 2s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19160",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19160", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 60, '2020-02-02 20:00:01')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 66, '2020-02-02 20:00:03')"},  
                        {"client":"python", "query_type": "table", "kill":"19160", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:15')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19160'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19160",
                    "expected_results":[
                        ["dev1", 60, "2020-02-02 20:00:00", "2020-02-02 20:00:03"],
                        ["dev2", 58.3, "2020-02-02 20:00:00", "2020-02-02 20:00:03"],
                        ["dev2", 66, "2020-02-02 20:00:03", "2020-02-02 20:00:13"]
                    ]
                }
            ]
        },
        {
            "id": 161,
            "tags": ["query_state", "window"],
            "name": "session_hop_window_query_view",
            "description": "recover session window query from view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, max(value), window_start, window_end from session(state_view_stream, timestamp, 2s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19161",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19161", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 60, '2020-02-02 20:00:01')"},
                        {"client":"python", "query_type": "table", "kill":"19161", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 66, '2020-02-02 20:00:03')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev3', 'ca', 58.3, '2020-02-02 20:00:05')"},
                        {"client":"python", "query_type": "stream","query_id":"19161-1", "terminate": "manual","wait":2, "query":"recover from '19161'"},
                        {"client":"python", "query_type": "table", "depends_on":"19161",  "wait":1, "query": "kill query where query_id='19161' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19161'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19161",
                    "expected_results":[
                        ["dev1", 60, "2020-02-02 20:00:00", "2020-02-02 20:00:03"],
                        ["dev2", 58.3, "2020-02-02 20:00:00", "2020-02-02 20:00:03"]
                    ]
                },
                {
                    "query_id":"19161-1",
                    "expected_results":[
                        ["dev2", 66, "2020-02-02 20:00:03", "2020-02-02 20:00:05"]
                    ]
                }
            ]
        },
        {
            "id": 162,
            "tags": ["query_state", "view"],
            "name": "to_float on filed out of map with emit version as view",
            "description": "create a stream state_view_stream with low_cardinality type and ingest, query view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, value_str string)"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select emit_version(), group_array(id) as ids, group_array(latest_value_str) as latest_value_strs, map_cast(ids, latest_value_strs) as id_value_strs, id_value_strs['a'] as id_value_a, to_float(id_value_a) from (select id, latest(value_str) as latest_value_str from state_view_stream group by id order by id)"},
                        {"client":"python", "query_type": "stream", "query_id":"19162",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view limit 2 settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19162", "wait":1,"query":"insert into state_view_stream (id, value_str) values ('a', '100.1') ('b', '200.1') ('c', '300.1')"},
                        {"client":"python", "query_type": "table", "kill":"19162", "kill_wait":3, "wait":2,"query":"insert into state_view_stream (id, value_str) values ('c', '400.1') ('d', '500.1') ('e', '600.1')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19162'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19162", 
                    "expected_results":[
                        ["0", "['a', 'b', 'c']", "['100.1', '200.1', '300.1']", "{'a': '100.1', 'b': '200.1', 'c': '300.1'}", "100.1", "100.1"], 
                        ["1", "['a', 'b', 'c', 'd', 'e']", "['100.1', '200.1', '400.1', '500.1', '600.1']", "{'a': '100.1', 'b': '200.1', 'c': '400.1', 'd': '500.1', 'e': '600.1'}", "100.1", "100.1"]
                    ]
                }
            ]
        },
        {
            "id": 163,
            "tags": ["query_state", "view", "bug"],
            "name": "to_float on filed out of map with emit version as view",
            "description": "create a stream state_view_stream with low_cardinality type and ingest, recover query view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, value_str string)"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select emit_version(), group_array(id) as ids, group_array(latest_value_str) as latest_value_strs, map_cast(ids, latest_value_strs) as id_value_strs, id_value_strs['a'] as id_value_a, to_float(id_value_a) from (select id, latest(value_str) as latest_value_str from state_view_stream group by id order by id)"},
                        {"client":"python", "query_type": "stream", "query_id":"19163",  "wait":1, "terminate":"manuel", "query":"subscribe to select * from state_view limit 2 settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19163", "kill":"19163", "kill_wait":3, "wait":1,"query":"insert into state_view_stream (id, value_str) values ('a', '100.1') ('b', '200.1') ('c', '300.1')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1,"query":"insert into state_view_stream (id, value_str) values ('c', '400.1') ('d', '500.1') ('e', '600.1')"},
                        {"client":"python", "query_type": "stream","query_id":"19163-1", "terminate": "manual","wait":2, "query":"recover from '19163'"},
                        {"client":"python", "query_type": "table", "depends_on":"19163",  "wait":1, "query": "kill query where query_id='19163' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19163'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19163", 
                    "expected_results":[
                        ["0", "['a', 'b', 'c']", "['100.1', '200.1', '300.1']", "{'a': '100.1', 'b': '200.1', 'c': '300.1'}", "100.1", "100.1"]
                    ]
                },
                {
                    "query_id":"19163-1", 
                    "expected_results":[
                        ["1", "['a', 'b', 'c', 'd', 'e']", "['100.1', '200.1', '400.1', '500.1', '600.1']", "{'a': '100.1', 'b': '200.1', 'c': '400.1', 'd': '500.1', 'e': '600.1'}", "100.1", "100.1"]
                    ]
                }
            ]
        },
        {
            "id": 164,
            "tags": ["query_state", "view", "dedup"],
            "name": "dedup on stream as view",
            "description": "dedup on stream as view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream(id int, value int, time datetime64(3,'UTC'))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value, time, to_string(time) as time_string from dedup(state_view_stream, id, value, to_string(time))"},
                        {"client":"python", "query_type": "stream", "query_id":"19164",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, count(), window_start, window_end from tumble(state_view, time, 5s) group by id, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19164", "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:05'), (1, 10, '2020-01-01 00:00:06')"},
                        {"client":"python", "query_type": "table", "kill":"19164", "kill_wait":3, "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:11'), (1, 10, '2020-01-01 00:00:12')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19164'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19164", 
                    "expected_results":[
                        ["0", "3", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "2", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "1", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["1", "3", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "2", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "1", 3, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"]
                    ]
                }
            ]
        },
        {
            "id": 165,
            "tags": ["query_state", "view", "dedup"],
            "name": "dedup on stream as view",
            "description": "dedup on stream as view, recover query view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream(id int, value int, time datetime64(3,'UTC'))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value, time, to_string(time) as time_string from dedup(state_view_stream, id, value, to_string(time))"},
                        {"client":"python", "query_type": "stream", "query_id":"19165",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, count(), window_start, window_end from tumble(state_view, time, 5s) group by id, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19165", "kill":"19165", "kill_wait":3, "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:05'), (1, 10, '2020-01-01 00:00:06')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:11'), (1, 10, '2020-01-01 00:00:12')"},
                        {"client":"python", "query_type": "stream","query_id":"19165-1", "terminate": "manual","wait":2, "query":"recover from '19165'"},
                        {"client":"python", "query_type": "table", "depends_on":"19165",  "wait":1, "query": "kill query where query_id='19165' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19165'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19165", 
                    "expected_results":[
                        ["0", "3", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "2", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "1", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"]
                    ]
                },
                {
                    "query_id":"19165-1", 
                    "expected_results":[
                        ["1", "3", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "2", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "1", 3, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"]
                    ]
                }
            ]
        },
        {
            "id": 166,
            "tags": ["query_state", "view", "dedup"],
            "name": "dedup on stream by calculated field as key as view",
            "description": "dedup on stream by calculated field as key as view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream(id int, value int, time datetime64(3,'UTC'))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value, time, to_string(time) as time_string from dedup(state_view_stream, id, value, to_string(time))"},
                        {"client":"python", "query_type": "stream", "query_id":"19166",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, count(), window_start, window_end from tumble(state_view, time, 5s) group by id, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19166", "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:05'), (1, 10, '2020-01-01 00:00:06')"},
                        {"client":"python", "query_type": "table", "kill":"19166", "kill_wait":3, "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:11'), (1, 10, '2020-01-01 00:00:12')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19166'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19166", 
                    "expected_results":[
                        ["0", "3", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "2", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "1", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["1", "3", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "2", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "1", 3, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"]
                    ]
                }
            ]
        },
        {
            "id": 167,
            "tags": ["query_state", "view", "dedup"],
            "name": "dedup on stream as view",
            "description": "dedup on stream as view, recover query view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream(id int, value int, time datetime64(3,'UTC'))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select id, value, time, to_string(time) as time_string from dedup(state_view_stream, id, value, to_string(time))"},
                        {"client":"python", "query_type": "stream", "query_id":"19167",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, count(), window_start, window_end from tumble(state_view, time, 5s) group by id, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19167", "kill":"19167", "kill_wait":3, "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:00'), (2, 10, '2020-01-01 00:00:00'), (3, 10, '2020-01-01 00:00:00'), (1, 10, '2020-01-01 00:00:05'), (1, 10, '2020-01-01 00:00:06')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1,"query":"insert into state_view_stream(id, value, time) values (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:07'), (2, 10, '2020-01-01 00:00:07'), (3, 10, '2020-01-01 00:00:07'), (1, 10, '2020-01-01 00:00:11'), (1, 10, '2020-01-01 00:00:12')"},
                        {"client":"python", "query_type": "stream","query_id":"19167-1", "terminate": "manual","wait":2, "query":"recover from '19167'"},
                        {"client":"python", "query_type": "table", "depends_on":"19167",  "wait":1, "query": "kill query where query_id='19167' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19167'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19167", 
                    "expected_results":[
                        ["0", "3", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "2", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"],
                        ["0", "1", 1, "2020-01-01 00:00:00+00:00", "2020-01-01 00:00:05+00:00"]
                    ]
                },
                {
                    "query_id":"19167-1", 
                    "expected_results":[
                        ["1", "3", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "2", 1, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"],
                        ["1", "1", 3, "2020-01-01 00:00:05+00:00", "2020-01-01 00:00:10+00:00"]
                    ]
                }
            ]
        },
        {
            "id": 168,
            "tags": ["query_state", "view", "dedup"],
            "name": "tumble aggr based on tail join table view",
            "description": "tumble aggr based on tail join table view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select a.id, b.type, a.value, a.timestamp from state_view_stream as a join table(view_join) as b on a.id = b.id"},
                        {"client":"python", "query_type": "stream", "query_id":"19168",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, type, count(), sum(value), min(value), max(value), window_start, window_end from tumble(state_view, timestamp, 5s) group by id, type, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19168", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 59, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 66, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 77, '2020-02-02 20:00:04')"},
                        {"client":"python", "query_type": "table", "kill": "19168", "kill_wait":3, "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 69, '2020-02-02 20:00:05')"},
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19168'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19168", 
                    "expected_results":[
                        ["0", "dev1", "roof", 3, 194.3, 58.3, 77, "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["0", "dev2", "field", 1, 66, 66, 66, "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                }
            ]
        },
        {
            "id": 169,
            "tags": ["query_state", "view", "bug"],
            "name": "recover tumble aggr based on tail join table view",
            "description": "recover tumble aggr based on tail join table view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select a.id, b.type as id_type, a.value, a.timestamp from state_view_stream as a join table(view_join) as b on a.id = b.id"},
                        {"client":"python", "query_type": "stream", "query_id":"19169",  "wait":1, "terminate":"manuel", "query":"subscribe to select emit_version(), id, id_type, count(), sum(value), min(value), max(value), window_start, window_end from tumble(state_view, timestamp, 5s) group by id, id_type, window_start, window_end settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19169", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 59, '2020-02-02 20:00:02')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 66, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 77, '2020-02-02 20:00:04')"},
                        {"client":"python", "query_type": "table", "kill": "19169", "kill_wait":3, "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 69, '2020-02-02 20:00:05')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev3', 'ca', 55, '2020-02-02 20:00:07')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 55, '2020-02-02 20:00:08')"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev3', 'ca', 72, '2020-02-02 20:00:09')"},
                        {"client":"python", "query_type": "table", "wait":1,"query":"insert into state_view_stream(id, location, value, timestamp) values ('dev4', 'ca', 77, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "stream","query_id":"19169-1", "terminate": "manual","wait":4, "query":"recover from '19169'"},
                        {"client":"python", "query_type": "table", "depends_on":"19169", "wait":1, "query": "kill query where query_id='19169' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19169'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19169", 
                    "expected_results":[
                        ["0", "dev1", "roof", 3, 194.3, 58.3, 77, "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["0", "dev2", "field", 1, 66, 66, 66, "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                },
                {
                    "query_id":"19169-1", 
                    "expected_results":[
                        ["1", "dev3", "window", 2, 127, 55, 72, "2020-02-02 20:00:05", "2020-02-02 20:00:10"],
                        ["1", "dev2", "field", 2, 124, 55, 69, "2020-02-02 20:00:05", "2020-02-02 20:00:10"]
                    ]
                }
            ]
        },
        {
            "id": 170,
            "tags": ["query_state", "view", "dedup"],
            "name": "global sum based on tail join table view",
            "description": "global sum based on tail join table view state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select a.id, b.type, a.value, a.timestamp from state_view_stream as a join table(view_join) as b on a.id = b.id"},
                        {"client":"python", "query_type": "stream", "query_id":"19170", "wait":1, "terminate":"manuel", "query":"subscribe to select id, type, count(value) from state_view group by id, type order by id, type settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19170", "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01') ('dev1', 'ca', 59, '2020-02-02 20:00:02') ('dev2', 'ca', 66, '2020-02-02 20:00:03') ('dev1', 'ca', 77, '2020-02-02 20:00:04')"},
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19170'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19170", 
                    "expected_results":[
                        ["dev1", "roof", "3"], 
                        ["dev2", "field", "1"]
                    ]
                }
            ]
        },
        {
            "id": 171,
            "tags": ["query_state", "view", "bug"],
            "name": "recover global sum based on tail join table view",
            "description": "recover global sum based on tail join table view from state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create view if not exists state_view as select a.id, b.type, a.value, a.timestamp from state_view_stream as a join table(view_join) as b on a.id = b.id"},
                        {"client":"python", "query_type": "stream", "query_id":"19171",  "wait":1, "terminate":"manuel", "query":"subscribe to select id, type, count(value) from state_view group by id, type order by id, type settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19171", "kill": "19171", "kill_wait":3, "wait":1, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01') ('dev1', 'ca', 59, '2020-02-02 20:00:02') ('dev2', 'ca', 66, '2020-02-02 20:00:03') ('dev1', 'ca', 77, '2020-02-02 20:00:04') "}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "kill": "19171", "kill_wait":3, "wait":3, "query":"insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 69, '2020-02-02 20:00:05') ('dev3', 'ca', 55, '2020-02-02 20:00:07') ('dev2', 'ca', 55, '2020-02-02 20:00:08') ('dev3', 'ca', 72, '2020-02-02 20:00:09')"},
                        {"client":"python", "query_type": "stream","query_id":"19171-1", "terminate": "manual","wait":4, "query":"recover from '19171'"},
                        {"client":"python", "query_type": "table", "depends_on":"19171", "wait":1, "query": "kill query where query_id='19171' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19171'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19171", 
                    "expected_results":[
                        ["dev1", "roof", "3"], 
                        ["dev2", "field", "1"]
                    ]
                },
                {
                    "query_id":"19171-1", 
                    "expected_results":[
                        ["dev1", "roof", "3"], 
                        ["dev2", "field", "3"], 
                        ["dev3", "window", "2"]
                    ]
                }
            ]
        },
        {
            "id": 172,
            "tags": ["query_state", "materialized view"],
            "name": "streaming tail from materialized view as 5s tumble window aggr",
            "description": "streaming tail from materialized view as tumble window aggregation state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as select id, sum(value) as sum_value, window_start as win_start, window_end as win_end from tumble(state_view_stream, timestamp, 5s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19172", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value, win_start, win_end from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19172", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01') ('dev1', 'ca', 59, '2020-02-02 20:00:02') ('dev2', 'ca', 66, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 77, '2020-02-02 20:00:04') ('dev2', 'ca', 69, '2020-02-02 20:00:05') ('dev3', 'ca', 55, '2020-02-02 20:00:07')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev3', 'ca', 55, '2020-02-02 20:00:07') ('dev2', 'ca', 69, '2020-02-02 20:00:08') ('dev3', 'ca', 72, '2020-02-02 20:00:09')"},  
                        {"client":"python", "query_type": "table", "kill":"19172", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:11')"},                      
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19172'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19172", 
                    "expected_results":[
                        ["dev1", "194.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"], 
                        ["dev2", "66.0", "2020-02-02 20:00:00", "2020-02-02 20:00:05"], 
                        ["dev3", "182.0", "2020-02-02 20:00:05", "2020-02-02 20:00:10"], 
                        ["dev2", "138.0", "2020-02-02 20:00:05", "2020-02-02 20:00:10"]
                    ]
                }
            ]
        },
        {
            "id": 173,
            "tags": ["query_state", "materialized view"],
            "name": "recover streaming tail from materialized view as 5s tumble window aggr",
            "description": "recover streaming tail from materialized view as 5s tumble window aggrfrom state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as select id, sum(value) as sum_value, window_start as win_start, window_end as win_end from tumble(state_view_stream, timestamp, 5s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19173", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value, win_start, win_end from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19173", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 58.3, '2020-02-02 20:00:01') ('dev1', 'ca', 59, '2020-02-02 20:00:02') ('dev2', 'ca', 66, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "kill":"19173", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 77, '2020-02-02 20:00:04') ('dev2', 'ca', 69, '2020-02-02 20:00:05') ('dev3', 'ca', 55, '2020-02-02 20:00:07')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev3', 'ca', 55, '2020-02-02 20:00:07') ('dev2', 'ca', 69, '2020-02-02 20:00:08') ('dev3', 'ca', 72, '2020-02-02 20:00:09')"},  
                        {"client":"python", "query_type": "table", "kill":"19173", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:11')"},                      
                        {"client":"python", "query_type": "stream","query_id":"19173-1", "terminate": "manual","wait":4, "query":"recover from '19173'"},
                        {"client":"python", "query_type": "table", "depends_on":"19173", "wait":1, "query": "kill query where query_id='19173' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19173'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19173", 
                    "expected_results":[
                        ["dev1", "194.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"], 
                        ["dev2", "66.0", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                },
                {
                    "query_id":"19173-1", 
                    "expected_results":[
                        ["dev3", "182.0", "2020-02-02 20:00:05", "2020-02-02 20:00:10"], 
                        ["dev2", "138.0", "2020-02-02 20:00:05", "2020-02-02 20:00:10"]
                    ]
                }
            ]
        },
        {
            "id": 174,
            "tags": ["query_state", "materialized view"],
            "name": "streaming tail from materialized view as 5s hop window aggr",
            "description": "streaming tail from materialized view as hop window aggregation state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as select id, count(value) as sum_value, window_start as win_start, window_end as win_end from hop(state_view_stream, timestamp, 3s, 5s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19174", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value, win_start, win_end from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19174", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:04')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 69, '2020-02-02 20:00:06')"},                      
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 68, '2020-02-02 20:00:07')"},  
                        {"client":"python", "query_type": "table", "kill":"19174", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19174'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19174", 
                    "expected_results":[
                        ["dev1", "1", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                        ["dev2", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev1", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev6", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev2", "1", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev8", "1", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev6", "2", "2020-02-02 20:00:03", "2020-02-02 20:00:08"]
                    ]
                }
            ]
        },
        {
            "id": 175,
            "tags": ["query_state", "materialized view"],
            "name": "recover streaming tail from materialized view as 5s hop window aggr",
            "description": "recover streaming tail from materialized view as hop window aggregation state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as select id, count(value) as sum_value, window_start as win_start, window_end as win_end from hop(state_view_stream, timestamp, 3s, 5s) group by id, window_start, window_end"},
                        {"client":"python", "query_type": "stream", "query_id":"19175", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value, win_start, win_end from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19175", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 66, '2020-02-02 20:00:04')"},
                        {"client":"python", "query_type": "table", "kill":"19175", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev6', 'ca', 69, '2020-02-02 20:00:06')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 68, '2020-02-02 20:00:07')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev8', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "stream","query_id":"19175-1", "terminate": "manual","wait":4, "query":"recover from '19175'"},
                        {"client":"python", "query_type": "table", "depends_on":"19175", "wait":1, "query": "kill query where query_id='19175' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19175'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19175", 
                    "expected_results":[
                        ["dev1", "1", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                        ["dev2", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev1", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                        ["dev6", "1", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]
                    ]
                },
                {
                    "query_id":"19175-1", 
                    "expected_results":[
                        ["dev2", "1", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev8", "1", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                        ["dev6", "2", "2020-02-02 20:00:03", "2020-02-02 20:00:08"]
                    ]
                }
            ]
        },
        {
            "id": 176,
            "tags": ["query_state", "materialized view"],
            "name": "materialized view with union selects",
            "description": "materialized view with union selects state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as (select id, sum(value) as sum_value from state_view_stream group by id limit 4 union select id, sum(value) as sum_value from state_view_stream group by id limit 4)"},
                        {"client":"python", "query_type": "stream", "query_id":"19176", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19176", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 69, '2020-02-02 20:00:06')"},  
                        {"client":"python", "query_type": "table", "kill":"19176", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev4', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19176'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19176", 
                    "expected_results":[
                        ["dev1", "57.3"],
                        ["dev1", "57.3"],
                        ["dev2", "58.3"],
                        ["dev1", "57.3"],
                        ["dev2", "58.3"],
                        ["dev1", "57.3"],
                        ["dev2", "58.3"],
                        ["dev2", "58.3"]
                    ]
                }
            ]
        },
        {
            "id": 177,
            "tags": ["query_state", "materialized view"],
            "name": "recover streaming tail from materialized view as 5s hop window aggr",
            "description": "recover streaming tail from materialized view as hop window aggregation state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop view if exists state_view"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists state_view_stream"},
                        {"client":"python", "query_type": "table", "exist":"state_view_stream", "exist_wait":2, "wait":1, "query":"create stream state_view_stream (id string, location string, value float, timestamp datetime64(3) default now64(3))"},
                        {"client":"python", "query_type": "table", "exist":"state_view", "exist_wait":2, "wait":1, "query":"create materialized view state_view as (select id, sum(value) as sum_value from state_view_stream group by id limit 4 union select id, sum(value) as sum_value from state_view_stream group by id limit 4)"},
                        {"client":"python", "query_type": "stream", "query_id":"19177", "wait":1, "terminate":"manuel", "query":"subscribe to select id, sum_value from state_view settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19177", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev1', 'ca', 57.3, '2020-02-02 20:00:00')"},
                        {"client":"python", "query_type": "table", "kill":"19177", "kill_wait":3, "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 58.3, '2020-02-02 20:00:03')"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev2', 'ca', 69, '2020-02-02 20:00:06')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into state_view_stream(id, location, value, timestamp) values ('dev4', 'ca', 67, '2020-02-02 20:00:10')"},
                        {"client":"python", "query_type": "stream","query_id":"19177-1", "terminate": "manual","wait":4, "query":"recover from '19177'"},
                        {"client":"python", "query_type": "table", "depends_on":"19177", "wait":1, "query": "kill query where query_id='19177' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19177'"}
                    ]
                }
            ],

            "expected_results": [
                {
                    "query_id":"19177", 
                    "expected_results":[
                        ["dev1", "57.3"],
                        ["dev2", "58.3"],
                        ["dev1", "57.3"],
                        ["dev2", "58.3"]
                    ]
                },
                {
                    "query_id":"19177-1", 
                    "expected_results":[
                        ["dev2", "58.3"],
                        ["dev1", "57.3"],
                        ["dev2", "127.3"],
                        ["dev2", "127.3"]
                    ]
                }
            ]
        },
        {
            "id": 178,
            "tags": ["query_state", "changelog_kv stream"],
            "name": "query from changelog_kv stream",
            "description": "query from changelog_kv stream state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists changelog_kv_state_stream"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"create stream if not exists changelog_kv_state_stream(id int, s string) primary key s settings mode='changelog_kv'"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s) values (1, 'a')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s) values (2, 'b')"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (1, 'a', -1)"},
                        {"client":"python", "query_type": "stream", "query_id":"19178", "wait":1, "terminate":"manuel", "query":"subscribe to select id, s from changelog_kv_state_stream settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19178", "kill":"19178", "kill_wait":3, "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (3, 'b', 1), (4, 'c', 1)"},
                        {"client":"python", "query_type": "table", "wait":3, "query":"unsubscribe to '19178'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19178", 
                    "expected_results":[
                        ["2", "b"],
                        ["3", "b"],
                        ["4", "c"]
                    ]
                }
            ]
        },
        {
            "id": 179,
            "tags": ["query_state", "changelog_kv stream", "bug"],
            "name": "changelog_kv stream with union selects",
            "description": "changelog_kv stream stream state checkpoint",
            "steps":[
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query":"drop stream if exists changelog_kv_state_stream"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"create stream if not exists changelog_kv_state_stream(id int, s string) primary key s settings mode='changelog_kv'"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (1, 'a', 1)"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (2, 'b', 1)"},  
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (1, 'a', -1)"},
                        {"client":"python", "query_type": "stream", "query_id":"19179", "wait":1, "terminate":"manuel", "query":"subscribe to select id, s from changelog_kv_state_stream settings checkpoint_interval=1"},
                        {"client":"python", "query_type": "table", "depends_on":"19179", "wait":1, "query": "kill query where query_id='19179' sync"}
                    ]
                },
                {
                    "statements": [
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (2, 'b', -1)"},
                        {"client":"python", "query_type": "table", "wait":1, "query": "insert into changelog_kv_state_stream(id, s, _tp_delta) values (4, 'c', 1)"},  
                        {"client":"python", "query_type": "stream","query_id":"19179-1", "terminate": "manual","wait":4, "query":"recover from '19179'"},
                        {"client":"python", "query_type": "table", "depends_on":"19179", "wait":1, "query": "kill query where query_id='19179' sync"},
                        {"client":"python", "query_type": "table", "wait":1, "query":"unsubscribe to '19179'"}
                    ]
                }
            ],
            "expected_results": [
                {
                    "query_id":"19179", 
                    "expected_results":[
                        ["2", "b"]
                    ]
                },
                {
                    "query_id":"19179-1", 
                    "expected_results":[
                        ["4", "c"]
                    ]
                }
            ]
        }
    ]
}