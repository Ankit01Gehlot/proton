{
  "test_suite_name": "multishards_stream",
  "tag": "smoke",
  "setup": {
    "statements": [
      {"client":"python", "query_type": "table","wait":1, "query":"drop stream if exists multishards_stream"},
      {"client":"python", "query_type": "table", "wait":2, "query":"create stream if not exists multishards_stream(i int) settings shards=3"}
    ]
  },
  "test_suite_config":{
    "tests_2_run": {"ids_2_run": ["all"], "tags_2_run":[], "tags_2_skip":{"default":["todo", "to_support", "change", "bug", "sample"]}}
  },
  "comments": "Tests covering the stream query smoke cases.",
  "tests": [
    {
      "id": 0,
      "tags": ["multishards_stream"],
      "name": "multishards-stream-ingest-tail-query",
      "description": "multishards stream with ingestion with tail query",
      "steps":[
        {
          "statements": [
            {"client":"python", "query_type": "table","wait":1, "query":"drop stream if exists multishards_stream"},
            {"client":"python", "query_type": "table", "wait":2, "query":"create stream if not exists multishards_stream(i int) settings shards=3"},
            {"client":"python","query_id":"1300", "depends_on_stream":"multishards_stream","query_end_timer":4, "query_type": "stream", "query":"select i from multishards_stream;"},
            {"client":"python", "query_type": "table","depends_on":1300, "wait":1, "query": "insert into multishards_stream(i) values (1)"},
            {"client":"python", "query_type": "table","depends_on":1300, "wait":1, "query": "insert into multishards_stream(i) values (2)"},
            {"client":"python", "query_type": "table","depends_on":1300, "wait":1, "query": "insert into multishards_stream(i) values (3)"}
          ]
        }
      ],
      "expected_results": [
        {
          "query_id":"1300",
          "expected_results":[
            [1], [2], [3]
          ]
        }
      ]
    },
    {
      "id": 1,
      "tags": ["multishards_stream"],
      "name": "multishards-stream-ingest-sum-query",
      "description": "multishards stream with ingestion with sum query",
      "steps":[
        {
          "statements": [
            {"client":"python","query_id":"1301", "depends_on_stream":"multishards_stream","query_end_timer":7, "query_type": "stream", "query":"select sum(i) as s from multishards_stream emit periodic 5s;"},
            {"client":"python", "query_type": "table","depends_on":1301, "wait":1, "query": "insert into multishards_stream(i) values (1)"},
            {"client":"python", "query_type": "table","depends_on":1301, "wait":1, "query": "insert into multishards_stream(i) values (2)"},
            {"client":"python", "query_type": "table","depends_on":1301, "wait":1, "query": "insert into multishards_stream(i) values (3)"}
          ]
        }
      ],
      "expected_results": [
        {
          "query_id":"1301",
          "expected_results":[
            [6]
          ]
        }
      ]
    }
  ]
}