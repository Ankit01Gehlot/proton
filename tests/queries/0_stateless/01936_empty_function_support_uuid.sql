SELECT empty(toUUID('00000000-0000-0000-0000-000000000000'));
SELECT not_empty(toUUID('00000000-0000-0000-0000-000000000000'));
SELECT uniqIf(uuid, empty(uuid)), uniqIf(uuid, not_empty(uuid))
FROM
(
    SELECT toUUID('00000000-0000-0000-0000-000000000002') AS uuid
    UNION ALL
    SELECT toUUID('00000000-0000-0000-0000-000000000000') AS uuid
    UNION ALL
    SELECT toUUID('00000000-0000-0000-0000-000000000001') AS uuid
);

DROP STREAM IF EXISTS users;
DROP STREAM IF EXISTS orders;

create stream users (user_id UUID) ;
create stream orders (order_id UUID, user_id UUID) ;

INSERT INTO users VALUES ('00000000-0000-0000-0000-000000000001');
INSERT INTO users VALUES ('00000000-0000-0000-0000-000000000002');
INSERT INTO orders VALUES ('00000000-0000-0000-0000-000000000003', '00000000-0000-0000-0000-000000000001');

SELECT
    uniq(user_id) AS users,
    uniqIf(order_id, not_empty(order_id)) AS orders
FROM
(
    SELECT * FROM users
) t1 ALL LEFT JOIN (
    SELECT * FROM orders
) t2 USING (user_id);

DROP STREAM users;
DROP STREAM orders;

